function createFormButtonModal(){const e=document.getElementById("AutofillModal");if(e){e.style.display="flex";const o=document.getElementById("AutofillModal-GatherButton");o.style.backgroundColor="#4285f4",o.style.cursor="pointer",o.disabled=!1;return void(document.getElementById("autofillModal-LoadingText").style.display="none")}const o=document.createElement("div");o.id="AutofillModal",o.style.backgroundColor="#fff",o.style.position="fixed",o.style.top="50px",o.style.left="50%",o.style.transform="translate(-50%, 0)",o.style.zIndex="99999",o.style.display="flex",o.style.flexDirection="column",o.style.gap="10px",o.style.alignItems="center",o.style.justifyContent="center",o.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.5)",o.style.padding="10px 20px",o.style.maxWidth="400px",o.style.borderRadius="5px";const t=document.createElement("p");t.innerHTML="Gather the data from the form submission.";const l=document.createElement("button");l.textContent="Fill Docs and Email",l.style.backgroundColor="#4285f4",l.style.color="#fff",l.style.borderRadius="5px",l.style.cursor="pointer",l.style.padding="10px 20px",l.id="AutofillModal-GatherButton";const n=document.createElement("button");n.textContent="Fill Crematory Forms",n.style.backgroundColor="#4285f4",n.style.color="#fff",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.padding="10px 20px",n.id="AutofillModal-GatherButton";const s=document.createElement("div");s.innerHTML="X",s.style.position="absolute",s.style.fontSize="20px",s.style.top="5px",s.style.right="5px",s.style.cursor="pointer";const r=document.createElement("p");r.innerHTML="Loading... Please wait...",r.style.display="none",r.id="autofillModal-LoadingText",o.appendChild(s),o.appendChild(t),o.appendChild(l),o.appendChild(n),o.appendChild(r),document.body.appendChild(o),l.addEventListener("click",(()=>{l.style.backgroundColor="#b8cff5",l.style.cursor="progress",l.disabled=!0,r.style.display="block";const e=window.location.pathname.split("/").pop();console.log("%cSubmission ID from URL:","color: green",e),chrome.runtime.sendMessage({action:"fillDocsAndEmail",submissionId:e},(async function(e){e.success?(console.log("%cForm Submission:","color: green",e.data),l.textContent="Completed.",l.style.backgroundColor="#fff",l.style.color="green",l.style.cursor="default",r.style.display="none",window.open(`https://mail.google.com/mail/u/0/#drafts/${e.draftId}`,"_blank"),e.data.letterDocId&&printGoogleDoc(e.data.letterDocId),e.data.envelopeDocId&&printGoogleDoc(e.data.envelopeDocId),window.open(`https://docs.google.com/document/d/${e.data.invoiceDocId}/edit`,"_blank")):(console.error("Failed to Fill Docs and Email:",e.error),l.textContent=`Failed: ${e.error}`,l.style.backgroundColor="#fff",l.style.color="red",l.style.cursor="default",r.style.display="none")}))})),n.addEventListener("click",(()=>{n.style.backgroundColor="#b8cff5",n.style.cursor="progress",n.disabled=!0,r.style.display="block";const e=window.location.pathname.split("/").pop();console.log("%cSubmission ID from URL:","color: green",e),chrome.runtime.sendMessage({action:"fillCrematoryForms",submissionId:e},(async function(e){e.success?(console.log("%cForm Submission:","color: green",e.data),r.style.display="none",n.style.backgroundColor="#fff",console.log(e.data.cremationType),"Retain"!==e.data.cremationType?(n.textContent="Completed.",n.style.color="green",chrome.storage.local.set({isAutofilling:!0}),window.open("https://www.pawsetrack.vet/app/dashboard","_blank")):(console.log("Client Will Retain Remains"),n.textContent="Client Will Retain Remains.",n.style.color="black",n.style.cursor="default")):(console.error("Failed to Fill Crematory Site:",e.error),n.textContent=`Failed: ${e.error}`,n.style.backgroundColor="#fff",n.style.color="red",n.style.cursor="default",r.style.display="none")}))})),s.addEventListener("click",(()=>{o.style.display="none"}))}function printGoogleDoc(e){chrome.runtime.sendMessage({action:"openAndPrintDoc",docId:e})}function printCurrentWindow(){window.print()}function delay(e){return new Promise((o=>setTimeout(o,e)))}chrome.runtime.onMessage.addListener(((e,o,t)=>{if("createFormButton"===e.action){const{type:o}=e;"NEW"===o&&createFormButtonModal()}}));