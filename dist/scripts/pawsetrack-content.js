const inputEvent=new Event("input",{bubbles:!0}),pageCompletionKeys=[],petAndOwnerKeys=["petName","species","breed","weight","birthDate","passingDate","sex","clientFirstName","clientLastName","clientEmail","clientPhone","clientAddress1","clientAddress2"],bundlesKeys=["pawOrNosePrint"],urnKeys=["urnChoice","isUrnEngraved","urnLine1","urnLine2","urnLine3","urnLine4"],memorialKeys=["pawOrNosePrint","clayNosePrint","clayPawPrint","additionalBoxedFurClipping","additionalFurClipping","additionalNosePrint","additionalPawPrint","cremationType"],reviewKeys=["collectionLocation","petHospital"];function getStoredData(e,t){chrome.storage.local.get(e,(function(n){e.forEach((e=>{n[e]||"clientAddress2"===e||console.warn(`${e} Does not exist: ${n[e]}`)})),t(n)}))}async function startNewOrder(){console.log("startNewOrder");const e=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("New Order")))));console.log(e),e.click()}async function selectCremationType(e){if(console.log(e),"Private"===e){const e=await waitForCondition((()=>[...document.querySelectorAll("div.service-selection")].find((e=>e.firstChild.textContent.includes("Private Cremation")))));console.log(e),e.click()}else if("Memorial"===e){const e=await waitForCondition((()=>[...document.querySelectorAll("div.service-selection")].find((e=>e.firstChild.textContent.includes("Communal Cremation")))));console.log(e),e.click()}}async function fillPetAndOwnerForm(e,t){const n=document.querySelector('input[placeholder="Date of Passing (yyyy-mm-dd)"]');n.value=t.passingDate.split(" ")[0],n.dispatchEvent(inputEvent);document.querySelector('input[formcontrolname="unitOfMeasure"]').nextElementSibling.lastChild.click();const o=document.querySelector('input[formcontrolname="gender"]');if("Male"===t.sex){o.nextElementSibling.firstChild.click()}else if("Female"===t.sex){o.nextElementSibling.lastChild.click()}e.name.value=t.petName,e.name.dispatchEvent(inputEvent),e.description.value=t.breed,e.description.dispatchEvent(inputEvent),e.inputtedWeight.value=t.weight,e.inputtedWeight.dispatchEvent(inputEvent),e.firstName.value=t.clientFirstName,e.firstName.dispatchEvent(inputEvent),e.lastName.value=t.clientLastName,e.lastName.dispatchEvent(inputEvent),e.emailAddress.value=t.clientEmail,e.emailAddress.dispatchEvent(inputEvent),e.phoneNumber.value=t.clientPhone,e.phoneNumber.dispatchEvent(inputEvent);const i=document.getElementById("typeahead-basic");i.dispatchEvent(inputEvent);const l=await waitForCondition((()=>i.nextElementSibling));console.log(l);(await waitForCondition((()=>[...l.querySelectorAll("*")].find((e=>e.textContent.includes(t.species)))))).click(),await waitForCondition((()=>!l.isConnected));const a=e.address1;console.log(a),a.value=`${t.clientAddress1}, ${t.clientAddress2}`,a.dispatchEvent(new Event("focus")),a.dispatchEvent(new Event("input")),await delay(500);const r=new KeyboardEvent("keydown",{keyCode:40});a.dispatchEvent(r),a.dispatchEvent(new Event("blur"));const c=await waitForCondition((()=>document.querySelector("button.btn.btn-primary.ms-2")));await waitForCondition((()=>!1===c.disabled)),c.click()}async function fillBundlesForm(e){if(console.log(e.pawOrNosePrint),"Nose print"===e.pawOrNosePrint){const e=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("Remove")))));console.log(e),e.click()}else if("Paw print"===e.pawOrNosePrint)await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("Remove")))));else if("No thank you"===e.pawOrNosePrint){const e=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("Remove")))));console.log(e),e.click()}document.querySelector("button.btn.btn-primary.ms-2").click()}async function selectUrn(e){console.log("selectUrn");const t=document.querySelector("button.btn.btn-primary.ms-2");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((t=>t.querySelector(".item-name")?.textContent.includes(e.urnChoice)))))).click();const n=await waitForCondition((()=>document.querySelector("div[class=modal-content]")));if(console.log(n),e.urnChoice.includes("Decorative Metal Standard Urn")){const e=await waitForCondition((()=>{const e=[...n.querySelectorAll("span")].find((e=>e.textContent.includes("Personalize this item?")))?.closest("form");return[...e.querySelectorAll("button")].find((e=>e.textContent.includes("Yes")))}));console.log(e),e.click()}const o=e.isUrnEngraved?"div.product-offering-item.my-3":"div.product-offering-item.my-3.active",i=await waitForCondition((()=>n.querySelector(o)));console.log(i),i.click(),handleUrnText(e,n),await delay(250);const l=n.querySelector("input[formcontrolname='confirmWarning']");console.log(l),l&&l.click();const a=await waitForCondition((()=>n.querySelector("button.btn.btn-primary")));console.log(a),a.click(),await waitForCondition((()=>!n.isConnected)),t.click()}async function handleUrnText(e,t){if(console.log(e.urnLine1,e.urnLine2,e.urnLine3,e.urnLine4),""!==e.urnLine1||""!==e.urnLine2||""!==e.urnLine3||""!==e.urnLine4){const n=await waitForCondition((()=>t.querySelector("input[placeholder='Line 1']")));n&&(n.value=e.urnLine1,n.dispatchEvent(inputEvent));const o=await waitForCondition((()=>t.querySelector("input[placeholder='Line 2']")));if(o&&(o.value=e.urnLine2,o.dispatchEvent(inputEvent)),e.isUrnEngraved){const n=await waitForCondition((()=>t.querySelector("input[placeholder='Line 3']")));n&&(n.value=e.urnLine3,n.dispatchEvent(inputEvent));const o=await waitForCondition((()=>t.querySelector("input[placeholder='Line 4']")));o&&(o.value=e.urnLine4,o.dispatchEvent(inputEvent))}}}async function fillMemorialForm(e){"Nose print"===e.pawOrNosePrint&&(e.additionalNosePrint=e.additionalNosePrint?e.additionalNosePrint++:1);for(let t=0;t<e.clayPawPrint;t++){console.log("Add Clay Paw Print");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((e=>e.querySelector(".item-name")?.textContent.includes("Clay Paw Print")))))).click();const e=await waitForCondition((()=>document.querySelector("div[class='modal-content']")));(await waitForCondition((()=>[...e.querySelectorAll("button")].find((e=>e.textContent.includes("Yes")))))).click();const t=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.querySelector("span")?.textContent.includes("Add")))));await waitForCondition((()=>!1===t.disabled)),t.click(),await waitForCondition((()=>!e.isConnected))}for(let t=0;t<e.clayNosePrint;t++){console.log("Add Clay Nose Print");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((e=>e.querySelector(".item-name")?.textContent.includes("Clay Paw Print")))))).click();const e=await waitForCondition((()=>document.querySelector("div[class='modal-content']")));(await waitForCondition((()=>[...e.querySelectorAll("button")].find((e=>e.textContent.includes("Yes")))))).click();const t=await waitForCondition((()=>document.getElementById("specialInstructions")));t.value="CLAY NOSE PRINT",t.dispatchEvent(inputEvent);const n=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.querySelector("span")?.textContent.includes("Add")))));await waitForCondition((()=>!1===n.disabled)),n.click(),await waitForCondition((()=>!e.isConnected))}for(let t=0;t<e.additionalBoxedFurClipping;t++)console.log("Add Boxed Fur Clipping");for(let t=0;t<e.additionalFurClipping;t++){console.log("Add Fur Clipping");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((e=>e.querySelector(".item-name")?.textContent.includes("Fur Clipping")))))).click();const e=await waitForCondition((()=>document.querySelector("div[class='modal-content']"))),t=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.querySelector("span")?.textContent.includes("Add")))));await waitForCondition((()=>!1===t.disabled)),t.click(),await waitForCondition((()=>!e.isConnected))}for(let t=0;t<e.additionalNosePrint;t++){console.log("Add Nose Print");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((e=>e.querySelector(".item-name")?.textContent.includes("Ink Nose Print")))))).click();const e=await waitForCondition((()=>document.querySelector("div[class='modal-content']"))),t=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.querySelector("span")?.textContent.includes("Add")))));await waitForCondition((()=>!1===t.disabled)),t.click(),await waitForCondition((()=>!e.isConnected))}for(let t=0;t<e.additionalPawPrint;t++){console.log("Add Paw Print");(await waitForCondition((()=>[...document.querySelectorAll("div[role=button]")].find((e=>e.querySelector(".item-name")?.textContent.includes("Ink Paw Print")))))).click();const e=await waitForCondition((()=>document.querySelector("div[class='modal-content']"))),t=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.querySelector("span")?.textContent.includes("Add")))));await waitForCondition((()=>!1===t.disabled)),t.click(),await waitForCondition((()=>!e.isConnected))}document.querySelector("button.btn.btn-primary.ms-2").click()}async function fillReviewForm(e){console.log("fillReviewForm"),console.log(e.collectionLocation);let t=[];if("Office"===e.collectionLocation){const n=document.createElement("ul"),o=document.createElement("li");o.textContent=`Add Collection Location: ${e.petHospital}`,n.appendChild(o),t.push(n)}else if("Pick-up"===e.collectionLocation){const e=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("Pickup From Care Center")))));console.log(e),e.click()}else if("Mailed"===e.collectionLocation){const e=await waitForCondition((()=>[...document.querySelectorAll("button")].find((e=>e.textContent.includes("Other")))));console.log(e),e.click();(await waitForCondition((()=>document.getElementById("specialInstructions")))).value="Mail ashes to Owner's home address"}else e.collectionLocation;console.log(t),t.length>0?createModalWindow(t):createModalWindow()}function createModalWindow(e=null){const t=document.createElement("div");t.id="AutofillModal",t.style.backgroundColor="#fff",t.style.position="fixed",t.style.top="50px",t.style.left="50%",t.style.transform="translate(-50%, 0)",t.style.zIndex="99999",t.style.display="flex",t.style.flexDirection="column",t.style.gap="10px",t.style.alignItems="center",t.style.justifyContent="center",t.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.5)",t.style.padding="10px 30px",t.style.maxWidth="400px",t.style.borderRadius="5px";const n=document.createElement("div");n.innerHTML="X",n.style.position="absolute",n.style.fontSize="20px",n.style.top="5px",n.style.right="5px",n.style.cursor="pointer";const o=document.createElement("p");o.innerHTML="<br><p>Form autofilled with last gathered Jotform Data.</p>",t.appendChild(n),t.appendChild(o),document.body.appendChild(t),console.log(e),e&&e.forEach((e=>{t.appendChild(e)})),n.addEventListener("click",(()=>{t.style.display="none"}))}function waitForCondition(e,t=100,n=6e4){return new Promise(((o,i)=>{const l=Date.now(),a=setInterval((()=>{const t=Date.now()-l,r=e();r&&(clearInterval(a),o(r)),t>=n&&(clearInterval(a),i("Max wait time exceeded."))}),t)}))}function delay(e){return new Promise((t=>setTimeout(t,e)))}chrome.runtime.onMessage.addListener(((e,t,n)=>{const{type:o,action:i}=e;getStoredData(["isAutofilling"],(async({isAutofilling:e})=>{if(e&&"NEW"===o)if("startNewOrder"===i)startNewOrder();else if("selectCremationType"===i)getStoredData(["cremationType"],(({cremationType:e})=>{selectCremationType(e)}));else if("fillPetAndOwnerForm"===i){const e=await waitForCondition((()=>document.forms[0]));getStoredData(petAndOwnerKeys,(t=>{fillPetAndOwnerForm(e,t)}))}else"fillBundlesForm"===i?getStoredData(bundlesKeys,(e=>{fillBundlesForm(e)})):"selectUrn"===i?getStoredData(urnKeys,(e=>{selectUrn(e)})):"fillMemorialForm"===i?getStoredData(memorialKeys,(e=>{fillMemorialForm(e)})):"fillReviewForm"===i&&(getStoredData(reviewKeys,(e=>{fillReviewForm(e)})),chrome.storage.local.set({isAutofilling:!1}))}))}));